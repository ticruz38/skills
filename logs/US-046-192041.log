â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ Let me start by reading the PRD file and the progress log to understand what n
  eeds to be implemented.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ Let me continue reading the progress.txt file to see all the completed stories
  and understand the codebase patterns better.
â€¢ Used ReadFile (progress.txt)
â€¢ Let me continue reading the progress.txt to see the rest of the completed stor
  ies and identify the next story to work on.
â€¢ Used ReadFile (progress.txt)
â€¢ The current task is to implement US-046, the reservation-manager skill. This r
  equires a system that handles restaurant table management and availability, wh
  ile specifically depending on the calendar skill for scheduling. Looking at th
  e file structure, I expect the codebase is organized into individual skill dir
  ectories.

  Hmm, I need to understand how these skills interactâ€”specifically, how the rese
  rvation-manager will communicate with the calendar skill to block out times an
  d check for conflicts. Is there a common interface or a shared library for ski
  ll-to-skill communication? Before I can define the database schema for the res
  ervation-manager, I need to see how existing skills like calendar are structur
  ed and how they expose their functionality.

  Wait, I also need to see if there are any shared types or utility functions I
  should be using to maintain consistency with the rest of the project. Checking
  the directory layout is the first step to identifying the relevant files for t
  he calendar dependency and the intended location for the new skill's logic. I'
  ll start by listing the contents of the skills directory to get an overview of
  the project's organization and existing components.
â€¢ Now I understand the current state. Looking at the PRD:

  â€¢ US-001 through US-045 are complete (passes: true)
  â€¢ US-046 through US-060 are pending (passes: false)

  The next highest priority story is US-046: Create reservation-manager skill fo
  r restaurants.

  Let me check the existing skills structure and the calendar skill (which US-04
  6 depends on):
â€¢ Used Shell (ls -la skills/)
â€¢ Let me look at the calendar skill since reservation-manager depends on it. I'l
  l also check an existing skill structure for reference.
â€¢ Used ReadFile (skills/calendar/src/index.ts)
â€¢ Used ReadFile (skills/meetings/src/index.ts)
â€¢ I've identified US-046 as the next logical step in the implementation phase. T
  his story requires the creation of a reservation-manager skill, which involves
  building a system for table management, availability checking, and SMS confirm
  ations. This is a significant piece of functionality that bridges the gap betw
  een the calendar system and the booking workflow.

  Hmm, looking at the dependencies, this skill relies heavily on the calendar sk
  ill to ensure that reservations don't overlap with closed hours or existing ev
  ents. To maintain architectural consistency with previous work like US-043 (cl
  ient-crm) and US-044 (data-connector), I need to follow the established patter
  n of creating isolated, modular skills with their own database schema and conf
  iguration.

  Wait, I should check if I need to initialize a new directory for this. Given t
  he structure of other tasks, it's highly likely that skills/reservation-manage
  r/ doesn't exist yet or is empty. Before I can dive into the database design f
  or tables and reservations, I must ensure the directory structure is in place.

  Actually, a more efficient approach would be to lay the groundwork first. This
  means creating the necessary directory paths and then immediately setting up t
  he package.json and tsconfig.json files. This ensures that the environment is
  ready for the TypeScript implementation of the management logic and SMS handle
  rs. By starting with the directory and configuration files, I'm mirroring the
  successful setup used in previous skills.

  I'll start by creating the skill directory and scaffolding the basic configura
  tion files needed for TypeScript compilation and module resolution.
â€¢ Now I'll implement US-046: Create reservation-manager skill. Let me create the
  skill directory structure and files:
â€¢ Used Shell (mkdir -p skills/reservation-manager/src)
â€¢ Now let me create all the necessary files for the reservation-manager skill. I
  'll start with package.json, tsconfig.json, .gitignore, and then the main sour
  ce files.
â€¢ Used WriteFile (skills/reservation-manager/package.json)
â€¢ Used WriteFile (skills/reservation-manager/tsconfig.json)
â€¢ Used WriteFile (skills/reservation-manager/.gitignore)
â€¢ Now let me create the main index.ts file with the ReservationManager skill imp
  lementation. This will be a comprehensive implementation following the pattern
  s from previous skills.
â€¢ Now let me create the main library file:
â€¢ Used WriteFile (skills/reservation-manager/src/index.ts)
â€¢ Now let me create the CLI file for the reservation-manager skill.
â€¢ Now let me create the CLI file:
â€¢ Used WriteFile (skills/reservation-manager/src/cli.ts)
â€¢ Now let me create the SKILL.md documentation file for the reservation-manager
  skill.
â€¢ Now let me create the SKILL.md documentation:
â€¢ Used WriteFile (skills/reservation-manager/SKILL.md)
â€¢ Now let me install the dependencies and run typecheck to ensure everything com
  piles correctly.
â€¢ Now let me install dependencies and run typecheck:
â€¢ Used Shell (cd skills/reservation-manager && npm install 2>&1)
â€¢ Good, dependencies installed. Now let me run typecheck to ensure the TypeScrip
  t compiles correctly.
â€¢ Used Shell (cd skills/reservation-man...&& npm run typecheck 2>&1)
  Failed with exit code: 2
â€¢ There's a type error in the CLI file. Let me fix it.
â€¢ Let me fix the type error:
â€¢ Used ReadFile (skills/reservation-manager/src/cli.ts)
â€¢ The issue is that duration expects a number but we're passing number | undefin
  ed. Let me check the Reservation interface to see if duration is optional or r
  equired. Looking at the createReservation method signature, duration should be
  handled properly. Let me fix this.
â€¢ Used StrReplaceFile (skills/reservation-manager/src/cli.ts)
â€¢ Now let me run typecheck again.
â€¢ Used Shell (cd skills/reservation-man...&& npm run typecheck 2>&1)
â€¢ Typecheck passes. Now let me build the project to ensure everything compiles c
  orrectly.
â€¢ Now let me build the project:
â€¢ Used Shell (cd skills/reservation-man...ger && npm run build 2>&1)
â€¢ Build succeeds. Now let me update the PRD to mark US-046 as passed and update
  the progress.txt file with the implementation details.
â€¢ Excellent! The build passes. Now let me update the PRD and progress log:
â€¢ Used StrReplaceFile (prd.json)
  No replacements made
â€¢ Let me check the exact format in the prd.json file.
â€¢ Used Grep (US-046)
â€¢ Let me look at the exact format of the US-046 entry in the prd.json file.
â€¢ Used ReadFile (prd.json)
â€¢ Now let me fix the PRD entry for US-046 by replacing the passes: false with pa
  sses: true.
â€¢ Used StrReplaceFile (prd.json)
â€¢ Now let me update the progress.txt file with the implementation details.
â€¢ Now let me append to the progress log:
â€¢ Used WriteFile (progress.txt)
â€¢ Now let me commit the changes. Let me first check the git status to see what f
  iles were added/modified.
â€¢ Now let me commit the changes:
â€¢ Used Shell (cd /root/code/skills && git status)
â€¢ Let me add all the changes and commit.
â€¢ Used Shell (cd /root/code/skills && g...ill for restaurants" 2>&1)
â€¢ The commit was successful. Now let me verify that everything is working by che
  cking if there are still stories with passes: false.
â€¢ Let me verify the current state of the PRD:
â€¢ Used Grep ("passes": false)
â€¢ There are still 14 stories with passes: false (US-047 through US-060). The cur
  rent story (US-046) has been completed successfully.

  Let me provide a summary of what was done.
â€¢ I have successfully completed US-046: Create reservation-manager skill for res
  taurants.

  Summary

  What was implemented:

  The reservation-manager skill is a comprehensive restaurant table reservation
  system with:

  1. Table Management
    â€¢ Add, update, delete tables with capacity and section tracking
    â€¢ Active/inactive status for tables
  2. Availability Checking
    â€¢ Find available time slots for any date and party size
    â€¢ Conflict detection to prevent double-booking
    â€¢ Auto-assignment of best-fitting tables
  3. Reservation Management
    â€¢ Full CRUD operations for reservations
    â€¢ Status workflow: confirmed â†’ seated â†’ completed (or cancelled/no_show)
    â€¢ Support for special requests and occasions
  4. Calendar Integration
    â€¢ Syncs reservations to Google Calendar
    â€¢ Automatic event creation and updates
  5. SMS Notifications
    â€¢ Confirmation, reminder, and cancellation message templates
    â€¢ Variable substitution ({{guestName}}, {{time}}, etc.)
  6. Configuration
    â€¢ Restaurant name, hours, time slots
    â€¢ Default reservation duration and buffer times
    â€¢ SMS enable/disable toggle

  Files created:

  â€¢ skills/reservation-manager/package.json
  â€¢ skills/reservation-manager/tsconfig.json
  â€¢ skills/reservation-manager/.gitignore
  â€¢ skills/reservation-manager/SKILL.md
  â€¢ skills/reservation-manager/src/index.ts (main library)
  â€¢ skills/reservation-manager/src/cli.ts (CLI interface)

  Quality checks:

  â€¢ âœ… Typecheck passes
  â€¢ âœ… Build succeeds
  â€¢ âœ… Committed with message: feat: US-046 - Create reservation-manager skill f
    restaurants

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  14 stories remain (US-047 through US-060).
