â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ I need to implement a user story, starting with a review of the PRD and projec
  t files. The instructions specify checking prd.json and progress.txt for conte
  xt and to identify the highest priority item. Hmm, waitâ€”I don't have visibilit
  y into the root directory yet. Before I can examine the PRD or update the agen
  t's logs, I need to confirm the exact locations of these files. I'll list the
  contents of the base directory and search for any JSON and text files to pinpo
  int the relevant documents. This will give me the map I need to navigate the r
  equirements and begin the implementation process efficiently.
â€¢ I'll start by reading the PRD and progress log to understand what needs to be
  implemented.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ Used Shell (ls -la /root/code/skills/)
â€¢ I have analyzed the prd.json file and the progress logs. The previous stories
  (US-001 through US-023) have been successfully implemented. The next step is t
  o implement US-024: Create image-prompts skill for AI image generation.

  Looking at the requirements, this skill needs to generate prompts for tools li
  ke Midjourney and DALL-E. It should include style-aware prompts, subject descr
  iptions, parameter suggestions, and prompt variations. Unlike most previous st
  ories, US-024 has no external dependencies, meaning it relies solely on the ma
  in model's generation capabilities and SQLite storage.

  Wait... before I begin writing the TypeScript code for the image-prompts modul
  e, I need to make sure I'm working on the correct branch. The PRD specifies a
  branch name ralph/all-skills. If I'm on a different branch, my changes might n
  ot integrate correctly with the existing features like the engagement-replies
  skill I just reviewed.

  Actually, I should check the current git status and recent commit history. Thi
  s will confirm whether the environment is clean and if I'm already on the targ
  et branch. It's better to verify the workspace state now than to deal with mer
  ge conflicts later.

  Once I've confirmed the branch and status, I'll be ready to create the image-p
  rompts directory and the necessary files: index.ts for the logic, cli.ts for t
  he interface, package.json, and tsconfig.json. I'll also need to ensure that t
  he implementation passes the required type checks as per the acceptance criter
  ia.

  Let me start by checking the git status and the branch I'm currently on.
â€¢ Let me check the current git status and look at the next user story to impleme
  nt.
â€¢ Used Shell (cd /root/code/skills && g...s && git log --oneline -3)
â€¢ Hmm, I'm on the ralph/all-skills branch. Looking at the PRD requirements, US-0
  24 is the highest priority story that hasn't been completed yet. It involves c
  reating an image-prompts skill for AI image generation.

  Wait, before I dive into the code, I need to see how these 'skills' are struct
  ured in this repository. They seem to be modular plugins. To ensure the new sk
  ill follows the established architecture, I should examine a similar, recently
  completed implementation. US-023, 'engagement-replies,' looks like a perfect r
  eference point as it likely deals with content generation and configuration.

  Actually, just looking at the source code might not be enough. Many of these p
  rojects use a specific meta-format for defining the skill's interface and capa
  bilities. I see there's a SKILL.md file in the engagement-replies directory. C
  hecking both the source structure and this metadata file will help me understa
  nd the boilerplate and logic patterns I need to replicate for the image-prompt
  s skill.
â€¢ I'm on the correct branch ralph/all-skills. The next user story to implement i
  s US-024: Create image-prompts skill for AI image generation.

  Let me check the existing skills structure and then implement this skill.
â€¢ Used Shell (ls -la /root/code/skills/...kills/engagement-replies/)
â€¢ Used ReadFile (skills/engagement-replies/SKILL.md)
â€¢ Now I have a good understanding of how skills are structured. Let me look at t
  he source files for the engagement-replies skill to understand the implementat
  ion patterns.
â€¢ Let me look at the source files to understand the implementation pattern:
â€¢ Used ReadFile (skills/engagement-replies/src/index.ts)
â€¢ Used ReadFile (skills/engagement-replies/package.json)
â€¢ Used ReadFile (skills/engagement-replies/tsconfig.json)
â€¢ I've reviewed the project structure. Now I need to implement US-024: an image-
  prompts skill. This involves generating prompts for tools like Midjourney and
  DALL-E.

  Hmm, the requirements mention style-aware generation and parameter suggestions
  . I should create a dedicated directory for this skill to keep the codebase or
  ganized. I'll need a standard package.json to define the skill's metadata and
  dependencies.

  Wait, I also need to consider the build environment. A tsconfig.json is essent
  ial for TypeScript support. But the core of the skill will be the logic in ind
  ex.ts and the interface in cli.ts.

  Actually, before diving into the code, I'll set up the file structure. This in
  volves creating the directory and its initial files: package.json, tsconfig.js
  on, src/index.ts, and src/cli.ts.
â€¢ Now I understand the pattern. Let me create the image-prompts skill for US-024
  :
â€¢ Used Shell (mkdir -p /root/code/skill.../skills/image-prompts/src)
â€¢ Used WriteFile (skills/image-prompts/package.json)
â€¢ Used WriteFile (skills/image-prompts/tsconfig.json)
â€¢ Used WriteFile (skills/image-prompts/.gitignore)
â€¢ Now let me create the main source files for the image-prompts skill. This will
  be a comprehensive implementation with:

  1. Support for multiple AI image generators (Midjourney, DALL-E, Stable Diffus
     )
  2. Style-aware prompt generation
  3. Subject description enhancement
  4. Parameter suggestions for each platform
  5. Prompt variations
  6. SQLite storage for prompt history and templates
â€¢ Now let me create the main index.ts file with the image prompts skill:
â€¢ Used WriteFile (skills/image-prompts/src/index.ts)
  Invalid arguments
â€¢ It looks like there was a JSON escaping issue. Let me try writing the file aga
  in with proper escaping.
â€¢ Let me fix the escaping issue and write the file again:
â€¢ Used WriteFile (skills/image-prompts/src/index.ts)
â€¢ Now let me create the CLI file for the image-prompts skill.
â€¢ Now let me create the CLI file:
â€¢ Used WriteFile (skills/image-prompts/src/cli.ts)
â€¢ Now let me create the SKILL.md documentation file and then build and typecheck
  the project.
â€¢ Now let me create the SKILL.md documentation:
â€¢ Used WriteFile (skills/image-prompts/SKILL.md)
â€¢ Now let me build the project and run typecheck to ensure everything is working
  correctly.
â€¢ Now let me install dependencies and build the project:
â€¢ Used Shell (cd /root/code/skills/skil...ompts && npm install 2>&1)
â€¢ Dependencies are installed. Now let me run the typecheck and build commands.
â€¢ Used Shell (cd /root/code/skills/skil...&& npm run typecheck 2>&1)
â€¢ Typecheck passes. Now let me build the project.
â€¢ Typecheck passes! Now let me build the project:
â€¢ Used Shell (cd /root/code/skills/skil...pts && npm run build 2>&1)
â€¢ Build succeeds! Now let me test the CLI to make sure it works.
â€¢ Build successful! Let me test the CLI to verify everything works:
â€¢ Used Shell (cd /root/code/skills/skil...e dist/cli.js health 2>&1)
â€¢ Used Shell (cd /root/code/skills/skil...mood mysterious -n 2 2>&1)
â€¢ Everything is working correctly! The skill is generating prompts properly with
  all the required features:

  â€¢ Style-aware prompts (fantasy style with keywords like "magical, ethereal, my
    ical")
  â€¢ Subject descriptions (enhanced with modifiers)
  â€¢ Parameter suggestions (version, stylize, chaos, etc.)
  â€¢ Prompt variations (5 variations generated)
  â€¢ Negative prompts
  â€¢ Platform-specific formatting

  Now let me update the PRD to set passes: true for US-024, commit the changes,
  and update progress.txt.
â€¢ Excellent! The skill is working perfectly. Now let me update the PRD and commi
  t the changes:
â€¢ Used StrReplaceFile (prd.json)
  No replacements made
â€¢ Let me check the exact format of the PRD file again to make the correct replac
  ement.
â€¢ Used Grep (US-024)
â€¢ I see. Let me use a simpler replacement that just changes the passes field.
â€¢ Used StrReplaceFile (prd.json)
  No replacements made
â€¢ Let me try a different approach - use a more direct pattern that focuses on th
  e specific line to change.
â€¢ Used Shell (cd /root/code/skills && s.../}' prd.json 2>&1 || true)
â€¢ Used Shell (cd /root/code/skills && g...024"' prd.json | head -15)
â€¢ Let me try a different sed approach with proper escaping.
â€¢ Used Shell (cd /root/code/skills && s...024"' prd.json | head -15)
â€¢ The PRD has been updated. Now let me commit all the changes and update the pro
  gress.txt file.
â€¢ The PRD is updated. Now let me commit the changes:
â€¢ Used Shell (cd /root/code/skills && git add -A && git status)
â€¢ Now let me commit the changes with the proper commit message format.
â€¢ Used Shell (cd /root/code/skills && g...AI image generation" 2>&1)
â€¢ Now let me update the progress.txt file with the information about the US-024
  implementation.
â€¢ Now let me update the progress.txt file:
â€¢ Used WriteFile (progress.txt)
â€¢ Let me verify the progress.txt was updated correctly and check if there are mo
  re stories to implement.
â€¢ Let me verify the implementation is complete and check the remaining stories:
â€¢ Used Shell (cd /root/code/skills && g..."passes": false' prd.json)
â€¢ Used Shell (cd /root/code/skills && g...false' prd.json | head -5)
â€¢ I have successfully completed the implementation of the image-prompts skill (U
  S-024). Looking at the requirements, it needed style-aware prompts, subject de
  scriptions, parameter suggestions, and prompt variations. My implementation co
  vers all of these: it supports 5 platforms (Midjourney, DALL-E, etc.), over 15
  art styles, 10 moods, 10 lighting styles, and includes a template system.

  Hmm, let me double-check the quality gates. The SQLite storage for history is
  functional, the CLI is fully operational with all command variants, and the np
  m run typecheck passed without errors. Everything is committed under "feat: US
  -024...".

  But waitâ€”how many stories are actually left in this milestone? I've been focus
  ed on the individual task, but I haven't checked the overall PRD progress. Loo
  king at the project structure, there are 36 stories still marked as incomplete
  . This means my current work, while complete, is just one step in a much large
  r roadmap.

  Actually, since US-024 is now finished and verified, there's no more code to w
  rite for this specific story. The logical next step isn't to start coding the
  next story immediately without directionâ€”that might lead to context switching
  errors. Instead, I need to synchronize with the system state. By checking the
  tail of the progress log, I can see the sequence of previous completions and e
  nsure my recent commit is correctly recorded in the project's history. This wi
  ll give me a clear view of what's next and confirm that the task hand-off is p
  roperly documented.
â€¢ I have successfully completed US-024: Create image-prompts skill for AI image
  generation.

  Summary

  The image-prompts skill has been implemented with the following features:

  Core Features:

  â€¢ Support for 5 AI image platforms: Midjourney, DALL-E, Stable Diffusion, Leon
    do, and Generic
  â€¢ 15+ art styles with style-aware keywords (photorealistic, anime, cyberpunk,
    l-painting, etc.)
  â€¢ 10 mood options (mysterious, epic, whimsical, dark, etc.)
  â€¢ 10 lighting styles (cinematic, golden-hour, neon, volumetric, etc.)
  â€¢ 10 camera perspectives (birds-eye, macro, isometric, dutch-angle, etc.)
  â€¢ Auto-generated negative prompts per platform and style
  â€¢ Platform-specific parameter suggestions
  â€¢ Prompt variations generator

  Template System:

  â€¢ 5 default templates: character-portrait, landscape-scene, product-shot, abst
    ct-art, architectural
  â€¢ Variable substitution with {{variableName}} syntax

  CLI Commands:

  â€¢ generate - Generate prompts with full options
  â€¢ template - Use templates with variable substitution
  â€¢ templates, history, stats, health
  â€¢ List commands for styles, moods, lighting, perspectives, platforms, aspect-r
    ios

  Quality:

  â€¢ TypeScript implementation with full type safety
  â€¢ SQLite storage for prompt history
  â€¢ Typecheck passes
  â€¢ All changes committed

  There are still 36 stories remaining with passes: false. The next highest prio
  rity story to implement would be US-025: Create hashtag-research skill for tre
  nding tags.
