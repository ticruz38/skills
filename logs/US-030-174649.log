â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ Let me start by reading the PRD file and the progress log to understand what n
  eeds to be done.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ Let me continue reading the progress.txt file to get a full picture, and also
  check what branch we're on.
â€¢ Let me continue reading the progress log and check the current branch:
â€¢ Used ReadFile (progress.txt)
â€¢ Used Shell (git branch --show-current)
â€¢ I'm on the correct branch ralph/all-skills. Now let me identify the highest pr
  iority story with passes: false. Looking at the PRD:

  US-030 (priority 30): web-search skill - passes: false US-031 (priority 31): n
  ews-aggregator skill - passes: false US-032 (priority 32): summarizer skill -
  passes: false ... and so on

  The highest priority one that's not done is US-030: web-search skill.

  Let me look at the current state of the skills directory to understand the pat
  tern better, then implement the web-search skill.
â€¢ I'm on the correct branch ralph/all-skills. Looking at the PRD, the highest pr
  iority story with passes: false is US-030: Create web-search skill for researc
  h (priority 30).

  Let me check the existing skill structure and then implement this skill:
â€¢ Used Glob (skills/*)
â€¢ Used Shell (cat skills/summarizer/SKI...xisting summarizer skill")
â€¢ Hmm, the web-search skill is missing despite being required by higher-level sk
  ills like summarizer. I need to implement the foundational logic for this skil
  l. Looking at the project structure, a robust skill needs both a library for c
  ore logic and a CLI for direct execution.

  Wait, should I use a scraping library like Cheerio? The requirement mentions a
  'Serper API key' as optional. It's better to design the core to be flexible, s
  upporting both a direct fetch implementation and a more robust API-based appro
  ach. This way, the skill remains functional even without third-party keys, ali
  gning with the 'optional' note.

  Actually, I see other skills using SQLite for caching. I should include that t
  o store results and avoid repeated network calls. For the CLI, a simple search
  command is essential. But before I get into the logic, I need the project stru
  cture. I'll need a package.json for dependencies like sqlite3 and a tsconfig.j
  son for the TypeScript environment.

  I also need a central index.ts for the WebSearchSkill class and a cli.ts to ha
  ndle the terminal interface. I'll organize these into a todo list to track the
  creation of these specific files and the overall directory setup. This ensures
  I don't miss any boilerplate while setting up the skill's architecture.
â€¢ Now I'll implement the web-search skill. Let me create the skill structure:
â€¢ Used SetTodoList
  â€¢ Create web-search skill directory and package.json â†
  â€¢ Create tsconfig.json and .gitignore
  â€¢ Create SKILL.md documentation
  â€¢ Implement src/index.ts - main library
  â€¢ Implement src/cli.ts - CLI interface
  â€¢ Run typecheck and verify
  â€¢ Commit changes and update progress
â€¢ Used Shell (mkdir -p skills/web-search/src)
â€¢ Let me create the package.json, tsconfig.json and the main source files for th
  e web-search skill.
â€¢ Used WriteFile (skills/web-search/package.json)
â€¢ Used WriteFile (skills/web-search/tsconfig.json)
â€¢ Used WriteFile (skills/web-search/.gitignore)
â€¢ Good, now let me create the SKILL.md documentation and the main source files.
â€¢ Used SetTodoList
  â€¢ Create web-search skill directory and package.json
  â€¢ Create tsconfig.json and .gitignore
  â€¢ Create SKILL.md documentation â†
  â€¢ Implement src/index.ts - main library
  â€¢ Implement src/cli.ts - CLI interface
  â€¢ Run typecheck and verify
  â€¢ Commit changes and update progress
â€¢ Used WriteFile (skills/web-search/SKILL.md)
â€¢ Now let me create the main index.ts file for the web-search skill. I need to i
  mplement:

  1. Search functionality (with Serper API if key available, otherwise fallback)
  2. Result caching in SQLite
  3. Source ranking
  4. Health check

  Let me write the implementation.
â€¢ Now let me create the main library file:
â€¢ Used WriteFile (skills/web-search/src/index.ts)
â€¢ Now let me create the CLI file.
â€¢ Now let me create the CLI:
â€¢ Used SetTodoList
  â€¢ Create web-search skill directory and package.json
  â€¢ Create tsconfig.json and .gitignore
  â€¢ Create SKILL.md documentation
  â€¢ Implement src/index.ts - main library
  â€¢ Implement src/cli.ts - CLI interface â†
  â€¢ Run typecheck and verify
  â€¢ Commit changes and update progress
â€¢ Used WriteFile (skills/web-search/src/cli.ts)
â€¢ Now let me run typecheck to make sure the code compiles correctly.
â€¢ Now let me run typecheck and verify the implementation:
â€¢ Used SetTodoList
  â€¢ Create web-search skill directory and package.json
  â€¢ Create tsconfig.json and .gitignore
  â€¢ Create SKILL.md documentation
  â€¢ Implement src/index.ts - main library
  â€¢ Implement src/cli.ts - CLI interface
  â€¢ Run typecheck and verify â†
  â€¢ Commit changes and update progress
â€¢ Used Shell (cd skills/web-search && npm install 2>&1)
â€¢ npm install succeeded. Now let me run typecheck.
â€¢ Used Shell (cd skills/web-search && npm run typecheck 2>&1)
â€¢ Typecheck passes. Now let me also run a quick test to make sure the CLI works.
â€¢ Typecheck passes. Let me test the CLI to verify it works:
â€¢ Used Shell (cd skills/web-search && n...& node dist/cli.js health)
â€¢ The skill works. Let me also test the search command.
â€¢ Used Shell (cd skills/web-search && n...t best practices" --num 3)
â€¢ The skill is working. Now let me update the PRD to set passes: true for US-030
  and commit the changes.
â€¢ The skill is working. Now let me update the PRD and commit the changes:
â€¢ Used SetTodoList
  â€¢ Create web-search skill directory and package.json
  â€¢ Create tsconfig.json and .gitignore
  â€¢ Create SKILL.md documentation
  â€¢ Implement src/index.ts - main library
  â€¢ Implement src/cli.ts - CLI interface
  â€¢ Run typecheck and verify
  â€¢ Commit changes and update progress â†
â€¢ Used StrReplaceFile (prd.json)
  No replacements made
â€¢ Let me check the exact format in the PRD file.
â€¢ Used Grep (US-030)
â€¢ I see - the JSON has specific formatting with newlines. Let me try a simpler r
  eplacement.
â€¢ Used StrReplaceFile (prd.json)
  No replacements made
â€¢ The formatting might be different. Let me just use a simpler pattern.
â€¢ Used Shell (sed -i 's/"id": "US-030",...ep -A 3 "US-030" prd.json)
â€¢ That changed ALL passes from false to true. Let me fix this - I need to revert
  and do this properly.
â€¢ Used Shell (git checkout prd.json && ...false' prd.json | head -5)
â€¢ Let me find the exact line number for US-030 and replace just that line.
â€¢ Used Shell (grep -n '"id": "US-030"' prd.json)
â€¢ US-030 starts at line 475. The "passes" field should be on line 486 (475 + 11
  lines). Let me verify.
â€¢ Used ReadFile (prd.json)
â€¢ Line 486 is the passes field for US-030. Let me use sed to replace just that l
  ine.
â€¢ Used Shell (sed -i '486s/"passes": fa...'"id": "US-030"' prd.json)
â€¢ Now let me commit the changes and update the progress log.
â€¢ Now let me commit the changes and update the progress log:
â€¢ Used Shell (git add -A && git status)
â€¢ Good. Now let me commit and then append to the progress log.
â€¢ Used Shell (git commit -m "feat: US-0...earch skill for research")
â€¢ Now let me append the progress log.
â€¢ Used WriteFile (progress.txt)
â€¢ Let me update the todo list and provide a summary.
â€¢ Used SetTodoList
  â€¢ Create web-search skill directory and package.json
  â€¢ Create tsconfig.json and .gitignore
  â€¢ Create SKILL.md documentation
  â€¢ Implement src/index.ts - main library
  â€¢ Implement src/cli.ts - CLI interface
  â€¢ Run typecheck and verify
  â€¢ Commit changes and update progress
â€¢ I have completed US-030: Create web-search skill for research. The skill is no
  w implemented with:

  1. Core functionality:
    â€¢ Search queries with structured results (title, URL, snippet, source, rank)
    â€¢ Source ranking by relevance
    â€¢ Result caching in SQLite with 7-day TTL
    â€¢ Safe search filtering
  2. Dual-mode operation:
    â€¢ Serper API mode when SERPER_API_KEY is set
    â€¢ Fallback mode returning search engine links when no API key
  3. CLI commands:
    â€¢ search <query> - Search the web
    â€¢ cache - View cache statistics
    â€¢ clear-cache --days N - Clear old cache entries
    â€¢ health - Check system health
  4. Typecheck passes âœ“
  5. Committed with message: feat: US-030 - Create web-search skill for research
  6. Updated progress.txt with implementation details

  There are still more stories with passes: false that need to be completed. Let
  me check the next one.
â€¢ I have completed US-030: Create web-search skill for research.

  Summary

  What was implemented:

  â€¢ Web Search Skill with comprehensive search functionality:
    â€¢ Query search with configurable number of results
    â€¢ Structured results (title, URL, snippet, source, rank)
    â€¢ Source ranking by relevance
    â€¢ SQLite-based result caching with 7-day TTL
    â€¢ Safe search filtering option
  â€¢ Dual-mode operation:
    â€¢ Serper API mode: Uses Serper.dev API when SERPER_API_KEY is set
    â€¢ Fallback mode: Returns links to Google, Bing, DuckDuckGo search pages when
      API key
  â€¢ CLI commands:
    â€¢ search <query> - Search with --num, --safe options
    â€¢ cache - View cache statistics
    â€¢ clear-cache --days N - Clear old entries
    â€¢ health - Check system health and API availability

  Files created:

  â€¢ skills/web-search/package.json
  â€¢ skills/web-search/tsconfig.json
  â€¢ skills/web-search/.gitignore
  â€¢ skills/web-search/SKILL.md
  â€¢ skills/web-search/src/index.ts
  â€¢ skills/web-search/src/cli.ts

  Verification:

  â€¢ âœ… Typecheck passes
  â€¢ âœ… CLI tested and working
  â€¢ âœ… Committed: feat: US-030 - Create web-search skill for research
  â€¢ âœ… PRD updated (passes: true)
  â€¢ âœ… Progress log appended

  The next highest priority story with passes: false is US-031: Create news-aggr
  egator skill for RSS feeds (priority 31).
