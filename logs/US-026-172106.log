â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ Let me start by reading the PRD file and progress log to understand what needs
  to be done.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ Let me continue reading the progress.txt file to see more of the patterns and
  completed work.
â€¢ Used ReadFile (progress.txt)
â€¢ Used Glob (skills/*)
â€¢ Let me check the current branch and identify the next story to work on. Lookin
  g at the PRD, US-026 through US-060 have passes: false. The highest priority o
  ne is US-026 (payment-reminders).
â€¢ Now I need to check the current branch and identify the next story to work on:
â€¢ Used Shell (cd /root/code/skills && git branch --show-current)
â€¢ I'm on the correct branch ralph/all-skills. Now let me look at what the highes
  t priority incomplete user story is. Looking at the prd.json, I need to find t
  he story with passes: false and the lowest priority number.

  Looking at the PRD, US-026 through US-060 have passes: false. The highest prio
  rity one is US-026 (payment-reminders).

  Let me check the invoices and email skills since payment-reminders depends on
  them.
â€¢ I'm on the correct branch. Looking at the PRD, the highest priority story with
  passes: false is US-026 - Create payment-reminders skill for invoice chasing.

  Let me first check the dependencies (invoices and email skills) to understand
  the existing patterns:
â€¢ Used ReadFile (skills/invoices/src/index.ts)
â€¢ Used ReadFile (skills/email/src/index.ts)
â€¢ The objective is clear: implement the payment-reminders skill (US-026) to auto
  mate invoice chasing. Looking at the project brief, this skill needs to handle
  escalating reminder schedules and customizable templates.

  Hmm... before I dive into the code, I need to understand the existing ecosyste
  m. I see skills/invoices and skills/email are already present. These are likel
  y critical dependencies. If I'm going to send reminders about invoices, I need
  to know how the invoices skill stores payment status and due dates.

  Wait, how should the project structure look? I should check the skills/ direct
  ory for a template or an existing skill like hashtag-research to see the stand
  ard layout for the SKILL.md manifest and the source files. This ensures the ne
  w skill is consistent with the rest of the system.

  Actually, just looking at the files isn't enough. I need to see the technical
  stack. Is it using package.json for dependencies? What are the build scripts?
  Reading a few package.json files from other skills will confirm if they follow
  a specific Node.js/TypeScript boilerplate that I should replicate.

  By gathering the file lists and the contents of these core files, I can map ou
  t exactly how the new skill should integrate with the existing ones and follow
  the established architectural patterns.
â€¢ Now let me look at a few more skill examples to understand the patterns:
â€¢ Used ReadFile (skills/invoices/src/index.ts)
â€¢ Used Shell (ls -la skills/invoices/ &...lls/invoices/package.json)
â€¢ Used Shell (ls -la skills/hashtag-res...tag-research/package.json)
â€¢ The acceptance criteria for the payment-reminders skill is clear: escalating r
  eminder schedules, customizable email templates, payment status tracking, clie
  nt-specific settings, and SQLite storage. To implement this, I'll need to inte
  grate with existing skills for data and communication.

  Hmm, I initially thought about using static analysis to find the right directo
  ries, but that might be misleading if the project uses complex path mapping. T
  he most reliable way to determine the actual dependencies is to look at the pa
  ckage.json files of the invoices and email skills. This will show me if they a
  re using standard npm packages or local workspace references.

  Actually, if they are local, the dependency names will be crucial for setting
  up my own package.json later. I also want to see if these skills are written i
  n TypeScript or JavaScript to match my implementation style. I'll check their
  metadata files now.
â€¢ Let me check the email skill's package.json to understand dependencies:
â€¢ Used Shell (cat skills/email/package.json)
â€¢ Used Shell (cat skills/invoices/package.json)
â€¢ I have a clear understanding of the requirements for the payment-reminders ski
  ll. It needs to automate invoice chasing by integrating with the invoices and
  email skills. The core logic involves escalating reminder schedules (e.g., 7 d
  ays before due, on the due date, and 7 days after), customizable templates, an
  d client-specific settings, all stored in SQLite.

  Wait, I need to be precise about the database structure. I'll need tables for
  reminder_schedules, reminder_templates, reminder_history, and client overrides
  . This ensures we can track what was sent and when. The integration logic is k
  ey: the skill must be able to pull invoice data and trigger the email skill's
  send function.

  Hmm, before I dive into the code, I need to establish the project structure. I
  'll be creating a new skill in skills/payment-reminders. This requires a speci
  fic set of files to be compatible with the OpenClaw skill system.

  Actually, looking at the existing skills directory, it seems each skill has it
  s own src folder and configuration files. To maintain consistency, I'll start
  by creating the necessary directories and configuration files.

  First, I'll need a .gitignore to exclude node_modules and dist. Then, a tsconf
  ig.json configured for a Node.js environment. These are the essential first st
  eps before I can write the logic in src/index.ts.

  I'll proceed by initializing the directory structure and these initial files t
  o set up the development environment for the payment-reminders skill.
â€¢ Now I'll create the payment-reminders skill. Let me set up the project structu
  re:
â€¢ Used Shell (mkdir -p skills/payment-reminders/src)
â€¢ Used WriteFile (skills/payment-reminders/.gitignore)
â€¢ Used WriteFile (skills/payment-reminders/tsconfig.json)
â€¢ Used WriteFile (skills/payment-reminders/package.json)
â€¢ Now let me create the main index.ts file for the payment-reminders skill. This
  will be a comprehensive implementation.
â€¢ Now let me create the main library file:
â€¢ Used WriteFile (skills/payment-reminders/src/index.ts)
â€¢ Now let me create the CLI file for the payment-reminders skill.
â€¢ Now let me create the CLI file:
â€¢ Used WriteFile (skills/payment-reminders/src/cli.ts)
â€¢ Now let me create the SKILL.md documentation file.
â€¢ Now let me create the SKILL.md documentation:
â€¢ Used WriteFile (skills/payment-reminders/SKILL.md)
â€¢ Now let me install dependencies and run typecheck to ensure everything compile
  s correctly.
â€¢ Now let me install dependencies and run typecheck:
â€¢ Used Shell (cd /root/code/skills/paym...nders && npm install 2>&1)
  Failed with exit code: 1
â€¢ I need to check the correct path. Let me look at the working directory.
â€¢ Used Shell (pwd && ls -la skills/)
â€¢ I see the payment-reminders folder exists but is missing the src directory I t
  hought I created. Let me check its contents.
â€¢ Used Shell (ls -la skills/payment-reminders/)
â€¢ Good, the files are there. Let me verify the src folder has both files.
â€¢ Used Shell (ls -la skills/payment-reminders/src/)
â€¢ All files are there. Now let me install the dependencies.
â€¢ Used Shell (cd skills/payment-reminders && npm install 2>&1)
â€¢ Good, npm install succeeded. Now let me run typecheck to make sure everything
  compiles.
â€¢ Used Shell (cd skills/payment-reminde...&& npm run typecheck 2>&1)
  Failed with exit code: 2
â€¢ There are type errors in the CLI. Let me fix those. The issue is that find ret
  urns Invoice | undefined but we're assigning to a variable that might be typed
  differently. Let me fix those issues.
â€¢ Let me fix the type errors:
â€¢ Used ReadFile (skills/payment-reminders/src/cli.ts)
â€¢ I see the issue. invoices.find() returns Invoice | undefined but getInvoice()
  returns Invoice | null. The variable invoice is typed as Invoice | undefined f
  rom the find, and we're trying to assign Invoice | null to it. I need to prope
  rly type the variable or handle the null case differently.

  Let me fix these issues.
â€¢ Used StrReplaceFile (skills/payment-reminders/src/cli.ts)
â€¢ Now let me run typecheck again to see if the issues are fixed.
â€¢ Used Shell (cd skills/payment-reminde...&& npm run typecheck 2>&1)
â€¢ Typecheck passes. Now let me build the project and run the CLI to test it.
â€¢ Typecheck passes. Now let me build the project:
â€¢ Used Shell (cd skills/payment-reminders && npm run build 2>&1)
â€¢ Build succeeded. Now let me test the CLI to make sure everything works.
â€¢ Let me test the CLI:
â€¢ Used Shell (cd skills/payment-reminde...e dist/cli.js --help 2>&1)
â€¢ The CLI works. Let me test a few more commands to make sure the database and o
  ther functionality is working correctly.
â€¢ Used Shell (cd skills/payment-reminde...ist/cli.js schedules 2>&1)
â€¢ The schedules are seeded correctly. Let me also check the templates.
â€¢ Used Shell (cd skills/payment-reminde...ist/cli.js templates 2>&1)
â€¢ All templates are seeded correctly. Let me also test the stats command and che
  ck the health.
â€¢ Used Shell (cd skills/payment-reminde...de dist/cli.js stats 2>&1)
â€¢ Good, the skill is working. Let me also run the status command to check the he
  alth.
â€¢ Used Shell (cd skills/payment-reminde...e dist/cli.js status 2>&1)
â€¢ All commands are working correctly. Now let me update the PRD to mark US-026 a
  s complete, and then append the progress to progress.txt.
â€¢ All tests pass. Now let me update the PRD and progress log:
â€¢ Used StrReplaceFile (prd.json)
â€¢ Now let me update the progress.txt with the completed story details.
â€¢ Used WriteFile (progress.txt)
â€¢ Now let me commit the changes.
â€¢ Now let me commit the changes:
â€¢ Used Shell (cd /root/code/skills && git add -A && git status)
â€¢ All files are staged. Let me commit with the appropriate message.
â€¢ Used Shell (cd /root/code/skills && g...for invoice chasing" 2>&1)
â€¢ The commit was successful. Let me verify by checking the PRD to confirm the st
  ory is marked as complete, and then check if there are more stories to complet
  e.
â€¢ Let me verify the PRD update:
â€¢ Used Shell (grep -A2 '"id": "US-026"' prd.json)
â€¢ Let me check the passes field to make sure it's updated.
â€¢ Used Shell (grep -A10 '"id": "US-026"' prd.json | grep passes)
â€¢ That's in the acceptance criteria. Let me get more lines to see the passes fie
  ld.
â€¢ Used Shell (grep -A15 '"id": "US-026"' prd.json)
â€¢ US-026 is now marked as passes: true. Let me check if there are more incomplet
  e stories in the PRD to see if we're done.
â€¢ US-026 is complete with passes: true. Let me check the remaining incomplete st
  ories:
â€¢ Used Shell (grep -B2 '"passes": false' prd.json | head -40)
â€¢ There are still many incomplete stories. The next one is US-027 (Create client
  -tracker skill for payment history). The task is complete for this iteration.
  Let me provide a summary of what was accomplished.
â€¢ There are still more stories to complete. Here's a summary of what was accompl
  ished in this iteration:

  Summary

  Completed Story: US-026 - Create payment-reminders skill for invoice chasing

  What was implemented:

  â€¢ Escalating reminder schedules - 3 default schedules (Standard, Gentle, Aggre
    ive) with configurable days before/after due dates
  â€¢ Email templates - 7 templates across 4 stages (pre_due, on_due, post_due, fi
    l) with 3 tones (friendly, firm, urgent)
  â€¢ Template variables - Support for {{clientName}}, {{invoiceNumber}}, {{amount
    , {{dueDate}}, {{daysUntilDue}}, {{daysOverdue}}, etc.
  â€¢ Client-specific settings - Enable/disable reminders per client, custom sched
    es
  â€¢ Payment status tracking - Full history of sent reminders with success/failur
    tracking
  â€¢ SQLite storage - 4 tables: reminder_schedules, reminder_templates, client_se
    ings, reminder_history
  â€¢ CLI commands - status, schedules, templates, client-settings, pending, send-
    l (with --dry-run), preview, send, history, stats

  Files created:

  â€¢ skills/payment-reminders/package.json
  â€¢ skills/payment-reminders/tsconfig.json
  â€¢ skills/payment-reminders/.gitignore
  â€¢ skills/payment-reminders/SKILL.md
  â€¢ skills/payment-reminders/src/index.ts
  â€¢ skills/payment-reminders/src/cli.ts

  Quality checks:

  â€¢ âœ… Typecheck passes
  â€¢ âœ… Build succeeds
  â€¢ âœ… CLI commands work correctly
  â€¢ âœ… Changes committed with message: feat: US-026 - Create payment-reminders s
    ll for invoice chasing

  The next highest priority story is US-027 - Create client-tracker skill for pa
  yment history.
