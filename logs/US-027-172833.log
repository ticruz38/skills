â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ The user wants me to act as an autonomous coding agent working on a software p
  roject. Let me start by reading the PRD file and the progress log to understan
  d what needs to be done.

  First, I need to:

  1. Read prd.json to understand the user stories and requirements
  2. Read progress.txt to check the codebase patterns and current status
  3. Check the branch situation
  4. Find the highest priority story with passes: false
  5. Implement it
  6. Run quality checks
  7. Commit and update progress

  Let me start by reading these files.
â€¢ I'll start by reading the PRD and progress files to understand what needs to b
  e implemented.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ Used Shell (cat /root/code/skills/.last-branch)
â€¢ Hmm, checking the PRD stories, US-001 through US-026 are already marked as pas
  sing. The next logical step is to tackle US-027: the client-tracker skill. Thi
  s seems like a foundational requirement for the CRM aspect of the project.

  Wait, let me double-check the progress logs I've seen so far. The timestamps j
  ump around a bitâ€”I've seen entries from 14:48 to 17:01. This suggests there mi
  ght be more recent activity or detailed context in the progress.txt file that
  I haven't reached yet. Since the file has over 1000 lines, the most recent con
  text is likely at the very end.

  Actually, before I commit to US-027, I should verify if there's any existing w
  ork on it or if there's a different story defined as the priority for the ralp
  h/all-skills branch. The branch name suggests we're bundling several features,
  so context is everything.

  Instead of reading the whole file again, I'll jump to the end of progress.txt
  to see the latest updates. This will give me the 'ground truth' on what's curr
  ently being worked on and ensure I don't duplicate effort or miss a recent piv
  ot in the project goals.
â€¢ Let me check the current branch and see what story needs to be worked on:
â€¢ Used Shell (git branch -a | head -20)
â€¢ Used ReadFile (progress.txt)
â€¢ Hmm, the PRD shows US-001 through US-026 are marked as passes: true, which mea
  ns the next item on my list is US-027: the client-tracker skill. This skill is
  intended for tracking client payment behavior and is a dependency for the invo
  ices skill.

  Wait, before I dive into the specific requirements of US-027, I need to ensure
  I'm following the established architectural patterns for this project. I see t
  here are already skills for 'payment-reminders' and 'invoices' in the director
  y. It would be inefficient to start US-027 from scratch without understanding
  how these related modules are structuredâ€”specifically how they handle data per
  sistence and logic flow.

  Actually, looking at the file structure, it seems each skill is self-contained
  . To maintain consistency, I should examine the implementations of the existin
  g financial skills. The payment-reminders and invoices skills are the most rel
  evant here. I'll start by listing their source files to identify which ones I
  should review to use as a reference for the new client-tracker implementation.
â€¢ I'm on the correct branch ralph/all-skills. Looking at the PRD, the next story
  to implement is US-027: Create client-tracker skill for payment history. This
  depends on the invoices skill.

  Let me first explore the existing skill patterns and the invoices skill that t
  his depends on:
â€¢ Used Glob (skills/invoices/src/*.ts)
â€¢ Used Glob (skills/payment-reminders/src/*.ts)
â€¢ Let me read the invoices skill to understand its API and data structures, sinc
  e client-tracker depends on it.
â€¢ Used ReadFile (skills/invoices/src/index.ts)
â€¢ Used ReadFile (skills/payment-reminders/src/index.ts)
â€¢ Now I have a good understanding of the patterns used in the codebase. Let me c
  ontinue reading the rest of the payment-reminders skill to understand it compl
  etely.
â€¢ Let me read the rest of the payment-reminders skill and also check an existing
  skill's package.json for structure:
â€¢ Used ReadFile (skills/payment-reminders/src/index.ts)
â€¢ Used ReadFile (skills/invoices/package.json)
â€¢ Used ReadFile (skills/payment-reminders/src/cli.ts)
â€¢ I've analyzed the existing invoices and payment-reminders skills to understand
  the project's architecture for US-027. The goal is to build a client-tracker s
  kill that provides a comprehensive view of client payment behavior.

  Hmm, the invoices skill already manages the core Client entity and provides ge
  tClientInvoices. However, the requirement for 'Credit risk scoring' and 'Commu
  nication logs' suggests this new skill needs its own dedicated data layer. It
  shouldn't just wrap existing data; it needs to aggregate and analyze it.

  Wait, if I want to track 'Payment history' effectively, I can't just look at t
  he current state of an invoice. I need to track how often a client is late. I'
  ll need to calculate metrics like 'Average Days Late' and 'On-time Payment Rat
  e'. This implies I'll need to iterate through the client's invoices, compare d
  ueDate with paidDate (or the current date for open invoices), and store these
  metrics in a local SQLite table.

  Actually, for the 'Credit risk scoring', I'll implement a weighted algorithm.
  If a client is > 60 days late, that's a high risk. If they've been consistent
  for a year, that's low risk. I'll assign scores (0-100) and categorize them as
  'Good', 'Fair', or 'Poor'.

  But what about the 'Communication log'? That's not in the invoices skill at al
  l. I'll need a communications table in this skill's database to store notes, c
  alls, and emails linked to specific client IDs. This ensures the user has a ce
  ntralized CRM-style history.

  Looking at the existing code, the pattern is clear: use a main Skill class, a
  local db instance, and a cli.ts for the interface. I must ensure client-tracke
  r can consume the invoices skill as a dependency to pull the raw data it needs
  for its analysis.

  The `Outstanding balances' requirement is straightforwardâ€”just a sum of non-pa
  id invoicesâ€”but I should present it in a clear, formatted summary alongside th
  e other metrics.

  I've mapped out the necessary database schema, the calculation logic for the r
  isk scores, and the CLI command structure. I'm ready to move from the analysis
  phase to implementation. I will now scaffold the skill by creating the directo
  ry structure and the initial SKILL.md file to define the skill's metadata and
  dependencies.
â€¢ Now I have a good understanding of the patterns. Let me create the client-trac
  ker skill for US-027. This skill tracks client payment behavior and depends on
  the invoices skill.
â€¢ Used Shell (mkdir -p /root/code/skill...skills/client-tracker/src)
â€¢ Used WriteFile (skills/client-tracker/SKILL.md)
â€¢ Now let me create the main index.ts file for the client-tracker skill with all
  the necessary features.
â€¢ Used WriteFile (skills/client-tracker/src/index.ts)
â€¢ Now let me create the CLI file for the client-tracker skill.
â€¢ Now let me create the CLI:
â€¢ Used WriteFile (skills/client-tracker/src/cli.ts)
â€¢ Now let me create the package.json, tsconfig.json, and .gitignore files for th
  e client-tracker skill.
â€¢ Now let me create the configuration files:
â€¢ Used WriteFile (skills/client-tracker/package.json)
â€¢ Used WriteFile (skills/client-tracker/tsconfig.json)
â€¢ Used WriteFile (skills/client-tracker/.gitignore)
â€¢ Now I need to install dependencies and build the client-tracker skill to make
  sure it passes the typecheck. Let me do that.
â€¢ Now let me install dependencies and run the typecheck:
â€¢ Used Shell (cd /root/code/skills/skil...acker && npm install 2>&1)
â€¢ Good, dependencies are installed. Now let me run the typecheck.
â€¢ Used Shell (cd /root/code/skills/skil...&& npm run typecheck 2>&1)
â€¢ The typecheck passes. Now let me also build the project to make sure everythin
  g works correctly.
â€¢ Typecheck passes. Let me also build the project:
â€¢ Used Shell (cd /root/code/skills/skil...ker && npm run build 2>&1)
â€¢ Build succeeded. Now let me update the PRD to mark US-027 as passing and then
  commit the changes.
â€¢ Build successful. Now let me update the PRD and commit the changes:
â€¢ Used StrReplaceFile (prd.json)
â€¢ Now let me commit the changes and update the progress log.
â€¢ Used Shell (cd /root/code/skills && g...for payment history" 2>&1)
â€¢ Now let me update the progress.txt file with the learnings for this iteration.
â€¢ Now let me update the progress.txt:
â€¢ Used WriteFile (progress.txt)
â€¢ Now I need to verify that there are still more stories to implement (US-028 th
  rough US-060). Let me check the current status of the PRD.
â€¢ Let me verify the current status of the PRD to see what stories remain:
â€¢ Used Shell (cd /root/code/skills && g...p -A1 "passes" | head -80)
â€¢ Good - US-027 is now marked as passes: true. The next story (US-028) has passe
  s: false, so there are still 33 stories remaining to implement (US-028 through
  US-060).

  Since there are still stories with passes: false, I should end my response nor
  mally, and another iteration will pick up the next story.
â€¢ I have successfully completed US-027: Create client-tracker skill for payment
  history.

  Summary

  Created the client-tracker skill that tracks client payment behavior with the
  following features:

  Core Features

  â€¢ Client Profiles: Extended client data with payment statistics (total invoice
    revenue, outstanding balance)
  â€¢ Payment History: Syncs from invoices with automatic days-late calculation
  â€¢ Credit Risk Scoring: Weighted algorithm using 4 factors:
    â€¢ On-time payment rate (40%)
    â€¢ Average payment days (30%)
    â€¢ Overdue ratio (20%)
    â€¢ Payment history length (10%)
  â€¢ Outstanding Balances: Real-time report sorted by amount
  â€¢ Communication Log: Track all client interactions

  CLI Commands

  â€¢ list, profile - Client viewing
  â€¢ payments, risk - Payment history and risk assessment
  â€¢ log, communications - CRM-style interaction tracking
  â€¢ balances, stats - Financial reporting
  â€¢ export, sync - Data management

  Files Created

  â€¢ skills/client-tracker/package.json
  â€¢ skills/client-tracker/tsconfig.json
  â€¢ skills/client-tracker/.gitignore
  â€¢ skills/client-tracker/SKILL.md
  â€¢ skills/client-tracker/src/index.ts
  â€¢ skills/client-tracker/src/cli.ts

  Typecheck passes and all changes have been committed.

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  There are still 33 remaining stories (US-028 through US-060) to implement. The
  next story in priority order is US-028: Create expense-categorizer skill for r
  eceipts.
