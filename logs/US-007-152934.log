â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ Let me start by reading the PRD and progress files to understand what needs to
  be done.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ I have reviewed the current state of the PRD and the project logs. US-001 thro
  ugh US-006 are marked as passing, which provides a solid base for the next pha
  se of development. Now, I need to address the first failing task: US-007, the
  Calendar Skill.

  According to the notes, this skill has a dependency on google-oauth. While I s
  ee google-oauth in the progress.txt logs, I haven't actually inspected its int
  ernal structure or how it manages its exported interfaces. To build a robust C
  alendar Skill that can list events, find free time slots, and handle recurring
  events, I must first understand the interface provided by the authentication l
  ayer.

  Wait, I should also look at the email skill. Since both likely interact with G
  oogle APIs, the email skill might serve as a useful reference for how the proj
  ect handles API pagination, error handling, and data synchronization. It's bet
  ter to align with existing patterns than to reinvent the wheel for the Calenda
  r implementation.

  Actually, before I write any code for US-007, I need to verify the physical la
  yout of the skills directory. I know auth-provider and google-oauth exist, but
  seeing the full list will help me determine if there are any other utility ski
  lls or shared libraries I should be aware of.

  Therefore, my immediate next steps are to gather this context. I'll examine th
  e source code of the dependency skills and perform a directory listing to ensu
  re I have a complete picture of the workspace. This will prevent any integrati
  on issues later in the process.
â€¢ Let me check the current branch and look at the existing skills structure to u
  nderstand the patterns better:
â€¢ Used Shell (git branch --show-current && ls -la skills/)
â€¢ Used ReadFile (skills/google-oauth/src/index.ts)
â€¢ Used ReadFile (skills/email/src/index.ts)
â€¢ I have a good understanding of the project structure and the existing implemen
  tations in google-oauth and email. Now I need to implement the calendar skill
  (US-007), which is the next priority task according to the requirements.

  Hmm, the calendar skill is architecturally similar to email. Both depend on th
  e google-oauth provider. For calendar, I'll need to implement several core fea
  tures: listing events with filters, creating and updating events, managing rec
  urring events, and finding free time slots using Google's FreeBusy API. I also
  need to ensure there's a local SQLite cache to keep the data performant and av
  ailable offline, following the pattern established in other skills.

  Wait, before I can define the data models or the caching layer, I need to ensu
  re the skill has a proper package structure and the necessary dependencies. I
  noticed that the google-oauth package exports GoogleOAuthClient, GoogleService
  , and GoogleScopes, which I'll need to import to handle authentication and req
  uest the correct https://www.googleapis.com/auth/calendar scope.

  But I shouldn't just assume the environment is ready. I need to verify the cur
  rent state of the skills/calendar directory. If there's an existing skeleton,
  I should build on it; otherwise, I'll need to initialize it from scratch. Spec
  ifically, I need to check if the package.json is configured with the correct d
  ependencies and if there's a tsconfig.json that aligns with the project's mono
  repo structure.

  Actually, looking at the directory structure again, I see skills/email and ski
  lls/google-oauth are already present. I'll use these as templates for the new
  skill's configuration. The first step is to examine the current contents of th
  e skills/calendar folder to see what's already there. This will dictate whethe
  r I need to create the configuration files or just modify them.
â€¢ I'm on the correct branch ralph/all-skills. Now I need to implement US-007 - t
  he Calendar skill. Let me check if there's an existing calendar skill structur
  e and also look at the email skill's package.json for reference:
â€¢ Used Shell (ls -la skills/calendar/ 2... skill doesn't exist yet")
â€¢ Used ReadFile (skills/email/package.json)
â€¢ Used ReadFile (skills/email/tsconfig.json)
â€¢ Now I have all the information I need to create the calendar skill. Let me cre
  ate the complete structure:

  1. package.json
  2. tsconfig.json
  3. .gitignore
  4. SKILL.md
  5. src/index.ts
  6. src/cli.ts

  The calendar skill needs to:

  â€¢ List events with time filters
  â€¢ Create events with attendees
  â€¢ Find free time slots
  â€¢ Update and delete events
  â€¢ Handle recurring events
  â€¢ Sync to SQLite cache
  â€¢ Typecheck passes
â€¢ Now I'll create the calendar skill. Let me create all the necessary files:
â€¢ Used Shell (mkdir -p skills/calendar/src)
â€¢ Now let me create the files. I'll create the main index.ts first.
â€¢ Used WriteFile (skills/calendar/package.json)
â€¢ Used WriteFile (skills/calendar/tsconfig.json)
â€¢ Used WriteFile (skills/calendar/.gitignore)
â€¢ Now let me create the main source file. The calendar skill needs to handle:

  1. List events with time filters
  2. Create events with attendees
  3. Find free time slots
  4. Update and delete events
  5. Handle recurring events
  6. Sync to SQLite cache

  Let me write the main index.ts file.
â€¢ Used WriteFile (skills/calendar/src/index.ts)
â€¢ Now I need to create the CLI file for the calendar skill.
â€¢ Used WriteFile (skills/calendar/src/cli.ts)
â€¢ Now I need to create the SKILL.md file. Let me look at the email skill's SKILL
  .md for reference.
â€¢ Used ReadFile (skills/email/SKILL.md)
â€¢ Now I can create the SKILL.md for the calendar skill. Let me model it after th
  e email skill's documentation.
â€¢ Used WriteFile (skills/calendar/SKILL.md)
â€¢ Now let me build the project and run typecheck to ensure everything works corr
  ectly.
â€¢ Now let me install dependencies and run typecheck:
â€¢ Used Shell (cd skills/calendar && npm install 2>&1)
â€¢ Good, dependencies are installed. Now let me run typecheck.
â€¢ Used Shell (cd skills/calendar && npm run typecheck 2>&1)
â€¢ Typecheck passes. Now let me build the project.
â€¢ Used Shell (cd skills/calendar && npm run build 2>&1)
â€¢ Build succeeds. Now I need to:

  1. Update the PRD to mark US-007 as passes: true
  2. Append progress to progress.txt
  3. Commit the changes

  Let me do these steps.
â€¢ Build succeeded. Now let me update the PRD and progress file:
â€¢ Used StrReplaceFile (prd.json)
â€¢ Now let me update the progress.txt file with the new entry. I need to add it a
  t the top of the file.
â€¢ Used StrReplaceFile (progress.txt)
â€¢ Now let me commit the changes with the appropriate message.
