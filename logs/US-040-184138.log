â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ Let me start by reading the PRD file and progress log to understand what needs
  to be done.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ Let me continue reading the progress.txt file to see the remaining entries and
  understand the Codebase Patterns.
â€¢ Used ReadFile (progress.txt)
â€¢ I have completed the review of the current project state. Out of the 60 total
  stories, 39 are already passing. The next logical step is to address US-040, '
  Create flight-search skill for travel,' which is the highest priority item cur
  rently marked as passes: false.

  To implement this correctly, I need to understand the existing architecture. T
  he skill will eventually need to integrate with external APIs (like Amadeus) o
  r perform web scraping. However, I first need to see how these integrations ar
  e structured within the OpenClaw system. I noticed an 'examples' directory in
  the file structure.

  Hmm, I should check if there are any templates or reference implementations th
  ere that demonstrate how to handle travel-related data or external API calls.
  This will ensure the new flight-search skill remains consistent with the proje
  ct's design patterns.

  Wait, I also need to verify the exact directory structure and where the source
  code for these skills is located. I'll check the 'skills' directory to see the
  layout of existing modules like 'auth-provider' and 'binance'. This will help
  me determine the correct placement for the new flight-search logic and confirm
  the naming conventions used across the ecosystem.

  Let me first check the current git branch and then explore the examples and sk
  ills directories to get a better understanding of what exists.
â€¢ Let me check the current git branch and explore the examples directory to unde
  rstand what exists:
â€¢ Used Shell (cd /root/code/skills && g...amples/ && ls -la skills/)
â€¢ Good, I can see we're on the correct branch ralph/all-skills. Now let me look
  at an existing skill to understand the pattern and then implement the flight-s
  earch skill (US-040). Let me look at a simple skill like web-search as a refer
  ence since it's also optional for external API and can use scraping.
â€¢ Let me look at an existing skill for reference pattern:
â€¢ Used ReadFile (skills/web-search/package.json)
â€¢ Used ReadFile (skills/web-search/src/index.ts)
â€¢ Used ReadFile (skills/web-search/tsconfig.json)
â€¢ Good, now I have a clear understanding of the pattern. Let me create the fligh
  t-search skill. This skill will:

  1. Search for flights between routes
  2. Support date flexibility
  3. Filter by airline/stops
  4. Cache results in SQLite
  5. Work with or without the Amadeus API (fallback to search engine links)

  Let me create the complete skill implementation.
â€¢ Now I understand the pattern. Let me create the flight-search skill (US-040):
â€¢ Used Shell (mkdir -p /root/code/skill.../skills/flight-search/src)
â€¢ Now let me create all the files for the flight-search skill.
â€¢ Used WriteFile (skills/flight-search/package.json)
â€¢ Used WriteFile (skills/flight-search/tsconfig.json)
â€¢ Used WriteFile (skills/flight-search/.gitignore)
â€¢ Now let me create the main index.ts file with the FlightSearchSkill class.
â€¢ Used WriteFile (skills/flight-search/src/index.ts)
â€¢ Now let me create the CLI file for the flight-search skill.
â€¢ Used WriteFile (skills/flight-search/src/cli.ts)
â€¢ Now let me create the SKILL.md documentation file.
â€¢ Used WriteFile (skills/flight-search/SKILL.md)
â€¢ Now let me install dependencies and run typecheck.
â€¢ Now let me install dependencies and run typecheck:
â€¢ Used Shell (cd /root/code/skills/skil...tall && npm run typecheck)
  Failed with exit code: 2
â€¢ I need to fix the TypeScript errors. The issue is with the return type of the
  searchWithAmadeus and searchWithSimulated methods. Let me fix them.
â€¢ I need to fix the TypeScript errors. Let me update the index.ts:
â€¢ Used StrReplaceFile (skills/flight-search/src/index.ts)
â€¢ Now I need to update the code inside searchWithSimulated to handle the optiona
  l options properly.
â€¢ Used StrReplaceFile (skills/flight-search/src/index.ts)
â€¢ Now let me run typecheck again.
â€¢ Used Shell (cd /root/code/skills/skil...arch && npm run typecheck)
  Failed with exit code: 2
â€¢ I need to update the generateFlightsForDate function signature and fix the oth
  er issues.
â€¢ Used StrReplaceFile (skills/flight-search/src/index.ts)
â€¢ I need to fix the cabin reference in the Flight object. Let me also check for
  the remaining issues.
â€¢ Used ReadFile (skills/flight-search/src/index.ts)
â€¢ I see the issue. The cabin and passengers fields are being used without defaul
  ts. Let me fix those.
â€¢ Used StrReplaceFile (skills/flight-search/src/index.ts)
â€¢ Now I need to fix the query object that returns from searchWithSimulated to ha
  ve default values.
â€¢ Used StrReplaceFile (skills/flight-search/src/index.ts)
â€¢ Now let me run typecheck again to see if all issues are resolved.
â€¢ Used Shell (cd /root/code/skills/skil...arch && npm run typecheck)
â€¢ Typecheck passes. Now let me run the build and test the CLI briefly to make su
  re everything works.
â€¢ Typecheck passes. Now let me build and test the skill:
â€¢ Used Shell (cd /root/code/skills/skil...t-search && npm run build)
â€¢ Build succeeded. Let me test the CLI with the health and airports commands.
â€¢ Used Shell (cd /root/code/skills/skil... dist/cli.js airports JFK)
â€¢ Now let me test a flight search to make sure it works.
â€¢ Used Shell (cd /root/code/skills/skil...x-stops 1 2>&1 | head -50)
â€¢ The flight search skill is working. Now let me commit the changes and update t
  he PRD.
â€¢ The skill is working. Let me test a few more features and then commit:
â€¢ Used Shell (cd /root/code/skills/skil...&& node dist/cli.js saved)
â€¢ Now let me commit the changes and update the PRD and progress.txt.
â€¢ Used Shell (cd /root/code/skills && g...ght-search/ && git status)
â€¢ Good, now let me commit the changes.
â€¢ Used Shell (cd /root/code/skills && g...-search skill for travel")
â€¢ Good, the commit was successful. Now let me update the PRD to mark US-040 as p
  assing.
â€¢ Now let me update the PRD to mark US-040 as passing:
â€¢ Used StrReplaceFile (prd.json)
â€¢ Now let me append to the progress.txt file with the learnings.
â€¢ Now let me append to the progress.txt:
â€¢ Used WriteFile (progress.txt)
â€¢ The flight-search skill has been successfully implemented. Let me verify the P
  RD update by checking the JSON.
â€¢ Let me verify the PRD update:
â€¢ Used Shell (cd /root/code/skills && g...'"id": "US-040"' prd.json)
â€¢ Let me verify the passes status specifically.
â€¢ Used Shell (cd /root/code/skills && g..."' prd.json | grep passes)
â€¢ The PRD has been updated correctly with passes: true. Let me check how many st
  ories remain to be completed.
â€¢ Used Shell (cd /root/code/skills && g...: false' prd.json | wc -l)
â€¢ I have successfully implemented the flight-search skill. The TypeScript compil
  ation passed, and the CLI is functional, allowing searches for flights between
  major airports with various filters. I've also committed all the new files and
  updated prd.json to mark US-040 as completed.

  Hmm... while I could jump straight into the next story (US-041), I need to ens
  ure the documentation reflects the patterns I used here. For instance, the fli
  ght-search skill relies on a specific SQLite structure for caching results and
  uses a flexible date approach that might be relevant for other travel-related
  features. If I don't document these implementation details now, they might be
  lost or inconsistently replicated later.

  Wait, let me check the current state of progress.txt. I should add a summary o
  f the work done for US-040, including the specific 'learnings' regarding the A
  madeus API integration (or lack thereof, opting for simulated data) and the ca
  ching strategy. This provides a clear trail of the project's evolution and the
  architectural decisions made during this sprint.

  Actually, before I proceed to the next task, I'll append the progress for this
  user story to progress.txt. This keeps the project status synchronized and ens
  ures the record is up-to-date with the latest developments in the ralph/all-sk
  ills branch. Once this is done, the current story will be fully wrapped up.
â€¢ I have successfully completed US-040: Create flight-search skill for travel. H
  ere's a summary:

  What was implemented:

  Flight Search Skill (skills/flight-search/)

  â€¢ Search flights between 35 major airports worldwide
  â€¢ Price comparison with sorting options (price, duration, departure, arrival)
  â€¢ Date flexibility - search +/- 3 days from target date
  â€¢ Filters: airline codes, maximum stops, max price, cabin class
  â€¢ Cabin classes: economy, premium_economy, business, first
  â€¢ Round-trip support with separate outbound and return flights
  â€¢ Saved searches stored in SQLite for recurring routes
  â€¢ Results caching with 1-hour TTL
  â€¢ Database: 27 airlines, 35 major airports

  CLI Commands:

  â€¢ search <origin> <destination> <date> - Search flights
  â€¢ airports [query] - List/search airports
  â€¢ airlines - List available airlines
  â€¢ save <name> <origin> <destination> - Save search
  â€¢ saved - List saved searches
  â€¢ status/health - Check system status

  Features:

  â€¢ Works without API key (simulated data)
  â€¢ Optional Amadeus API integration (set AMADEUS_API_KEY)
  â€¢ Direct booking links to Google Flights, Kayak, Expedia

  Files created:

  â€¢ skills/flight-search/package.json
  â€¢ skills/flight-search/tsconfig.json
  â€¢ skills/flight-search/.gitignore
  â€¢ skills/flight-search/SKILL.md
  â€¢ skills/flight-search/src/index.ts
  â€¢ skills/flight-search/src/cli.ts

  All changes committed and PRD updated. 20 stories remain to be completed.
