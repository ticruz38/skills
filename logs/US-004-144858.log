â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ Let me start by reading the PRD file and the progress log to understand what n
  eeds to be done.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ I have identified the next task in the pipeline: creating the quickbooks-auth
  skill. This involves implementing a specific OAuth flow for QuickBooks, managi
  ng the unique Realm ID, and handling sandbox versus production toggles.

  Wait, before I start defining the directory structure or installing dependenci
  es, I need to check the current Git state. The instructions specify that I sho
  uld be working on the ralph/all-skills branch. I shouldn't assume the environm
  ent is already set up correctly. If I'm on the wrong branch, or if there are u
  ncommitted changes from previous steps, I'll run into issues later when I try
  to commit the new skill code.

  Actually, looking at the history, I see that google-oauth and binance-auth hav
  e already been merged into this branch. I need to ensure I'm up to date with t
  hose changes to maintain consistency across the authentication modules. Verify
  ing the branch and status now will prevent any "dirty tree" errors when I'm re
  ady to commit. Let's see where we stand.
â€¢ Let me check the current branch and then implement US-004 (quickbooks-auth ski
  ll).
â€¢ Used Shell (git branch --show-current && git status)
â€¢ I'm currently on the ralph/all-skills branch, which is exactly where I need to
  be to implement the QuickBooks authentication skill. The task is to build US-0
  04. Looking at the requirements, I need to handle the OAuth flow, store the Re
  alm ID and tokens, manage sandbox vs production environments, and ensure token
  s are refreshed automatically.

  Wait, before I jump into coding the TypeScript files, I should take a look at
  how other complex OAuth skills are structured in this repository. I see skills
  /google-oauth and skills/auth-provider. The auth-provider likely serves as the
  foundation for these integrations. If I want to maintain consistency across th
  e OpenClaw ecosystem, I should mirror the architecture of the Google OAuth imp
  lementation, as it likely handles similar token lifecycle challenges.

  Hmm... I also notice some untracked files and logs lying around. While they ar
  en't directly related to the code logic, it's good practice to verify the stat
  e of the working directory before starting a new major feature. I want to make
  sure I'm building on a clean slate.

  But the most critical step right now is to understand the existing implementat
  ion patterns. If I just start writing, I might miss specific library conventio
  ns or helper functions designed for OAuth 2.0 flows. By examining the google-o
  auth and auth-provider directories, I can deduce the standard for dependency m
  anagement, configuration handling, and perhaps even the specific TypeScript in
  terfaces I need to implement. This will ensure that the new QuickBooks skill i
  s integrated seamlessly into the existing framework. I'll start by listing the
  contents of these existing skills and checking my current directory status.
â€¢ Good, I'm on the correct branch. Now let me look at the existing auth-provider
  to understand the QuickBooks adapter pattern and implement the quickbooks-auth
  skill.
â€¢ Used Shell (ls -la skills/)
â€¢ Used Glob (skills/google-oauth/**/*)
â€¢ Used Glob (skills/auth-provider/**/*)
â€¢ Let me read the specific source files I need - the QuickBooks provider from au
  th-provider and the google-oauth skill implementation as a reference pattern.
â€¢ Let me read the key source files for the auth-provider QuickBooks adapter and
  the google-oauth skill as a reference:
â€¢ Used ReadFile (skills/auth-provider/src/providers/quickbooks.ts)
â€¢ Used ReadFile (skills/auth-provider/src/types.ts)
â€¢ Used ReadFile (skills/google-oauth/src/index.ts)
â€¢ Used ReadFile (skills/google-oauth/package.json)
â€¢ Now I have a good understanding of the patterns. Let me also read the google-o
  auth SKILL.md and the google-oauth CLI to understand the full pattern.
â€¢ Let me also read the SKILL.md and CLI from google-oauth to understand the full
  pattern:
â€¢ Used ReadFile (skills/google-oauth/SKILL.md)
â€¢ Used ReadFile (skills/google-oauth/src/cli.ts)
â€¢ Used ReadFile (skills/auth-provider/src/index.ts)
â€¢ I have analyzed the existing google-oauth and binance-auth implementations wit
  hin the skills/ directory. It's clear that the architecture for QuickBooks nee
  ds to mirror these existing skills to maintain consistency across the codebase
  . The auth-provider package seems to be the central hub for handling different
  OAuth flows, including the specific requirements for QuickBooks' Realm ID.

  Hmm... I need to ensure that the new quickbooks-auth skill handles the sandbox
  vs. production toggle correctly, similar to how binance-auth handles testnets.
  But wait, before I dive into the logic of index.ts or the CLI commands, I shou
  ld establish the structural foundation.

  Actually, looking at the previous implementations, each skill is a self-contai
  ned package with its own package.json, TypeScript configuration, and source tr
  ee. If I jump straight into the code, I'll likely run into path resolution iss
  ues or missing dependency errors during the build process.

  The QuickBooksProviderAdapter in the auth-provider package provides the low-le
  vel OAuth logic, so the new skill can simply wrap that functionality. However,
  I can't write the SKILL.md or the source files without a place to put them.

  Therefore, the first logical step is to prepare the directory structure. I'll
  create the quickbooks-auth directory and its src subdirectory to house the upc
  oming implementation files. This ensures the environment is ready for the Type
  Script source code and configuration files.
â€¢ Now I have a complete understanding of the pattern. Let me create the quickboo
  ks-auth skill following the same structure as google-oauth and binance-auth.
â€¢ Used Shell (mkdir -p skills/quickbooks-auth/src)
â€¢ Now let me create the files for the quickbooks-auth skill.
â€¢ Used WriteFile (skills/quickbooks-auth/package.json)
â€¢ Used WriteFile (skills/quickbooks-auth/tsconfig.json)
â€¢ Used WriteFile (skills/quickbooks-auth/.gitignore)
â€¢ Now let me create the main index.ts file for the quickbooks-auth skill.
â€¢ Used WriteFile (skills/quickbooks-auth/src/index.ts)
â€¢ Now let me create the CLI file for quickbooks-auth.
â€¢ Used WriteFile (skills/quickbooks-auth/src/cli.ts)
â€¢ Now let me create the SKILL.md file for the quickbooks-auth skill.
â€¢ Used WriteFile (skills/quickbooks-auth/SKILL.md)
â€¢ Now I need to build the project and run typecheck to make sure everything comp
  iles. Let me also install dependencies and build.
â€¢ Now let me install dependencies and build the project:
â€¢ Used Shell (cd skills/quickbooks-auth && npm install 2>&1)
â€¢ Good, dependencies installed. Now let me run typecheck to make sure everything
  compiles.
â€¢ Used Shell (cd skills/quickbooks-auth...&& npm run typecheck 2>&1)
  Failed with exit code: 2
â€¢ I need to fix the type error in index.ts. Let me check and fix that line.
â€¢ Used ReadFile (skills/quickbooks-auth/src/index.ts)
â€¢ I see. The realmId can be null from getRealmId(), but the return type expects
  string | undefined. Let me fix this by converting null to undefined.
â€¢ Used StrReplaceFile (skills/quickbooks-auth/src/index.ts)
â€¢ Now let me run typecheck again.
â€¢ Used Shell (cd skills/quickbooks-auth...&& npm run typecheck 2>&1)
â€¢ Typecheck passes. Now let me build the project.
â€¢ Typecheck passes. Now let me build the project:
â€¢ Used Shell (cd skills/quickbooks-auth && npm run build 2>&1)
â€¢ The build succeeded. Let me verify the dist files were created and then commit
  the changes.
â€¢ Used Shell (ls -la skills/quickbooks-auth/dist/)
â€¢ The build succeeded. Now let me commit the changes and update the PRD and prog
  ress.txt. First, let me see what files need to be added.
â€¢ Build successful. Now let me commit the changes:
