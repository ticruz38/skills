â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ # Ralph Agent Instructions                                                   â”‚
â”‚                                                                              â”‚
â”‚ You are an autonomous coding agent working on a software project.            â”‚
â”‚                                                                              â”‚
â”‚ ## ğŸ›¡ï¸ CRITICAL SAFETY RULES - NEVER VIOLATE                                   â”‚
â”‚                                                                              â”‚
â”‚ ### System Resource Protection                                               â”‚
â”‚ The following actions are **STRICTLY PROHIBITED** and will cause harm to the â”‚
â”‚ host system:                                                                 â”‚
â”‚                                                                              â”‚
â”‚ **Docker/Container Management:**                                             â”‚
â”‚ - **NEVER** run `docker stop` without an explicit container name or ID       â”‚
â”‚ - **NEVER** use `docker stop $(docker ps -q)` or any pattern that stops mult â”‚
â”‚ iple/all containers                                                          â”‚
â”‚ - **NEVER** run `docker rm -f $(docker ps -aq)` or similar mass-removal comm â”‚
â”‚ ands                                                                         â”‚
â”‚ - **ALWAYS** verify container names with `docker ps --filter name=<pattern>` â”‚
â”‚ before stopping                                                              â”‚
â”‚ - **ONLY** stop containers that were explicitly created by this session      â”‚
â”‚ - **ONLY** stop containers using their explicit name: `docker stop <exact-co â”‚
â”‚ ntainer-name>`                                                               â”‚
â”‚                                                                              â”‚
â”‚ **Process Management:**                                                      â”‚
â”‚ - **NEVER** run `killall`, `pkill`, or similar commands without specific pro â”‚
â”‚ cess names                                                                   â”‚
â”‚ - **NEVER** use `kill -9` on system processes or processes you didn't start  â”‚
â”‚ - **ONLY** terminate processes you explicitly started in this session        â”‚
â”‚                                                                              â”‚
â”‚ **Port/Network Conflicts:**                                                  â”‚
â”‚ - If a port is in use, **USE A DIFFERENT PORT** instead of killing the proce â”‚
â”‚ ss using it                                                                  â”‚
â”‚ - Check what's running on a port with `lsof -i :<port>` or `ss -tlnp | grep  â”‚
â”‚ <port>`                                                                      â”‚
â”‚ - Prefer random/high ports (e.g., `docker run -p 0:8080`) to avoid conflicts â”‚
â”‚                                                                              â”‚
â”‚ **General Safety:**                                                          â”‚
â”‚ - **NEVER** run commands that affect system-wide state unless explicitly req â”‚
â”‚ uired by the PRD                                                             â”‚
â”‚ - **NEVER** use wildcards or glob patterns with destructive commands (`rm`,  â”‚
â”‚ `kill`, `stop`)                                                              â”‚
â”‚ - When in doubt, be explicit and specific with resource names                â”‚
â”‚                                                                              â”‚
â”‚ ---                                                                          â”‚
â”‚                                                                              â”‚
â”‚ ## Your Task                                                                 â”‚
â”‚                                                                              â”‚
â”‚ 1. Read the PRD at `prd.json` (in the same directory as this file)           â”‚
â”‚ 2. Read the progress log at `progress.txt` (check Codebase Patterns section  â”‚
â”‚ first)                                                                       â”‚
â”‚ 3. Check you're on the correct branch from PRD `branchName`. If not, check i â”‚
â”‚ t out or create from main.                                                   â”‚
â”‚ 4. Pick the **highest priority** user story where `passes: false`            â”‚
â”‚ 5. Implement that single user story                                          â”‚
â”‚ 6. Run quality checks (e.g., typecheck, lint, test - use whatever your proje â”‚
â”‚ ct requires)                                                                 â”‚
â”‚ 7. Update AGENTS.md files if you discover reusable patterns (see below)      â”‚
â”‚ 8. If checks pass, commit ALL changes with message: `feat: [Story ID] - [Sto â”‚
â”‚ ry Title]`                                                                   â”‚
â”‚ 9. Update the PRD to set `passes: true` for the completed story              â”‚
â”‚ 10. Append your progress to `progress.txt`                                   â”‚
â”‚                                                                              â”‚
â”‚ ## Progress Report Format                                                    â”‚
â”‚                                                                              â”‚
â”‚ APPEND to progress.txt (never replace, always append):                       â”‚
â”‚ ```                                                                          â”‚
â”‚ ## [Date/Time] - [Story ID]                                                  â”‚
â”‚ - What was implemented                                                       â”‚
â”‚ - Files changed                                                              â”‚
â”‚ - **Learnings for future iterations:**                                       â”‚
â”‚   - Patterns discovered (e.g., "this codebase uses X for Y")                 â”‚
â”‚   - Gotchas encountered (e.g., "don't forget to update Z when changing W")   â”‚
â”‚   - Useful context (e.g., "the evaluation panel is in component X")          â”‚
â”‚ ---                                                                          â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ The learnings section is critical - it helps future iterations avoid repeati â”‚
â”‚ ng mistakes and understand the codebase better.                              â”‚
â”‚                                                                              â”‚
â”‚ ## Consolidate Patterns                                                      â”‚
â”‚                                                                              â”‚
â”‚ If you discover a **reusable pattern** that future iterations should know, a â”‚
â”‚ dd it to the `## Codebase Patterns` section at the TOP of progress.txt (crea â”‚
â”‚ te it if it doesn't exist). This section should consolidate the most importa â”‚
â”‚ nt learnings:                                                                â”‚
â”‚                                                                              â”‚
â”‚ ```                                                                          â”‚
â”‚ ## Codebase Patterns                                                         â”‚
â”‚ - Example: Use `sql<number>` template for aggregations                       â”‚
â”‚ - Example: Always use `IF NOT EXISTS` for migrations                         â”‚
â”‚ - Example: Export types from actions.ts for UI components                    â”‚
â”‚ ```                                                                          â”‚
â”‚                                                                              â”‚
â”‚ Only add patterns that are **general and reusable**, not story-specific deta â”‚
â”‚ ils.                                                                         â”‚
â”‚                                                                              â”‚
â”‚ ## Update AGENTS.md Files                                                    â”‚
â”‚                                                                              â”‚
â”‚ Before committing, check if any edited files have learnings worth preserving â”‚
â”‚ in nearby AGENTS.md files:                                                   â”‚
â”‚                                                                              â”‚
â”‚ 1. **Identify directories with edited files** - Look at which directories yo â”‚
â”‚ u modified                                                                   â”‚
â”‚ 2. **Check for existing AGENTS.md** - Look for AGENTS.md in those directorie â”‚
â”‚ s or parent directories                                                      â”‚
â”‚ 3. **Add valuable learnings** - If you discovered something future developer â”‚
â”‚ s/agents should know:                                                        â”‚
â”‚    - API patterns or conventions specific to that module                     â”‚
â”‚    - Gotchas or non-obvious requirements                                     â”‚
â”‚    - Dependencies between files                                              â”‚
â”‚    - Testing approaches for that area                                        â”‚
â”‚    - Configuration or environment requirements                               â”‚
â”‚                                                                              â”‚
â”‚ **Examples of good AGENTS.md additions:**                                    â”‚
â”‚ - "When modifying X, also update Y to keep them in sync"                     â”‚
â”‚ - "This module uses pattern Z for all API calls"                             â”‚
â”‚ - "Tests require the dev server running on PORT 3000"                        â”‚
â”‚ - "Field names must match the template exactly"                              â”‚
â”‚                                                                              â”‚
â”‚ **Do NOT add:**                                                              â”‚
â”‚ - Story-specific implementation details                                      â”‚
â”‚ - Temporary debugging notes                                                  â”‚
â”‚ - Information already in progress.txt                                        â”‚
â”‚                                                                              â”‚
â”‚ Only update AGENTS.md if you have **genuinely reusable knowledge** that woul â”‚
â”‚ d help future work in that directory.                                        â”‚
â”‚                                                                              â”‚
â”‚ ## Quality Requirements                                                      â”‚
â”‚                                                                              â”‚
â”‚ - ALL commits must pass your project's quality checks (typecheck, lint, test â”‚
â”‚ )                                                                            â”‚
â”‚ - Do NOT commit broken code                                                  â”‚
â”‚ - Keep changes focused and minimal                                           â”‚
â”‚ - Follow existing code patterns                                              â”‚
â”‚                                                                              â”‚
â”‚ ## Browser Testing (Required for Frontend Stories)                           â”‚
â”‚                                                                              â”‚
â”‚ For any story that changes UI, you MUST verify it works in the browser:      â”‚
â”‚                                                                              â”‚
â”‚ 1. Load the `dev-browser` skill                                              â”‚
â”‚ 2. Navigate to the relevant page                                             â”‚
â”‚ 3. Verify the UI changes work as expected                                    â”‚
â”‚ 4. Take a screenshot if helpful for the progress log                         â”‚
â”‚                                                                              â”‚
â”‚ A frontend story is NOT complete until browser verification passes.          â”‚
â”‚                                                                              â”‚
â”‚ ## Stop Condition                                                            â”‚
â”‚                                                                              â”‚
â”‚ After completing a user story, check if ALL stories have `passes: true`.     â”‚
â”‚                                                                              â”‚
â”‚ If ALL stories are complete and passing, reply with:                         â”‚
â”‚ <promise>COMPLETE</promise>                                                  â”‚
â”‚                                                                              â”‚
â”‚ If there are still stories with `passes: false`, end your response normally  â”‚
â”‚ (another iteration will pick up the next story).                             â”‚
â”‚                                                                              â”‚
â”‚ ## Important                                                                 â”‚
â”‚                                                                              â”‚
â”‚ - Work on ONE story per iteration                                            â”‚
â”‚ - Commit frequently                                                          â”‚
â”‚ - Keep CI green                                                              â”‚
â”‚ - Read the Codebase Patterns section in progress.txt before starting         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
â€¢ Let me start by reading the PRD file and the progress log to understand what n
  eeds to be done.
â€¢ Used ReadFile (prd.json)
â€¢ Used ReadFile (progress.txt)
â€¢ Let me analyze the current state:

  1. The PRD has 60 user stories total
  2. Stories US-001 through US-011 have passes: true (completed)
  3. The next story with passes: false and highest priority is US-012 - "Create
     rts skill for price notifications"

  Let me check the current branch and then implement US-012.

  US-012: Create alerts skill for price notifications

  â€¢ Priority: 12
  â€¢ Depends on: binance
  â€¢ Acceptance Criteria:
    â€¢ Set price thresholds
    â€¢ Percentage change alerts
    â€¢ Multi-channel notifications (Telegram, Slack)
    â€¢ Alert history
    â€¢ Batch notifications
    â€¢ Typecheck passes

  I need to:

  1. Check the current branch
  2. Create the alerts skill
  3. Run typecheck
  4. Commit changes
  5. Update PRD and progress.txt
â€¢ Let me check the current branch and look at the existing skills structure to u
  nderstand the patterns better:
â€¢ Used Shell (git branch --show-current && ls -la skills/)
â€¢ I'm on the correct branch ralph/all-skills. Now I need to implement US-012: Cr
  eate alerts skill for price notifications.

  Let me look at the binance skill to understand the interface I'll be building
  on top of:
â€¢ Let me examine the binance skill to understand the interface I'll be building
  on:
â€¢ Used ReadFile (skills/binance/src/index.ts)
â€¢ Used ReadFile (skills/binance/package.json)
â€¢ Used ReadFile (skills/slack/src/index.ts)
â€¢ Hmm, looking at the requirements for US-012, this 'alerts' skill is more than
  just a simple notification wrapper. It needs to handle price thresholds and pe
  rcentage changes. This means it must actively monitor data from the binance sk
  ill. But how should it notify the user? The PRD mentions multi-channel support
  . I could try to integrate Telegram or email, but waitâ€”the slack skill is alre
  ady a stable dependency in this environment. Using Slack provides a reliable b
  aseline for notifications without needing external API keys for this specific
  task.

  Actually, if I'm tracking price changes, I can't just store values in memory;
  the skill needs to remember historical data to calculate percentages accuratel
  y. Looking at previous implementations, they rely on local sqlite3 databases f
  or state persistence. So, my architecture for this skill will be a modular des
  ign: an AlertsSkill class that orchestrates a PriceMonitor (interfacing with b
  inance), a NotificationManager (interfacing with slack), and a Storage layer f
  or the SQLite logic.

  I need to define the core data models first. I'll need interfaces for Alert, P
  riceThreshold, and NotificationChannel. The Alert interface should be flexible
  enough to support 'above', 'below', and 'percent_change' types. For the sqlite
  3 schema, I'll need a table to store these alert definitions and another to lo
  g the notification history to prevent spamming the user with repeated alerts.

  Before I start writing the logic, I need to establish the project structure. I
  'll need a package.json to define the skill's metadata and dependencies, a tsc
  onfig.json to ensure the TypeScript compilation matches the project's standard
  s, and a .gitignore to keep the workspace clean. I also need a SKILL.md file t
  o document the configuration and usage for the system. Once the boilerplate is
  in place, I can focus on the src/index.ts implementation, which will house the
  main skill class and the database initialization logic. I'll start by setting
  up the project environment.
â€¢ Now I'll create the alerts skill. This skill will monitor crypto prices and se
  nd notifications when thresholds are hit. Let me create all the necessary file
  s:
â€¢ Used Shell (mkdir -p skills/alerts/src)
â€¢ Now let me create all the files for the alerts skill.
â€¢ Used WriteFile (skills/alerts/package.json)
â€¢ Used WriteFile (skills/alerts/tsconfig.json)
â€¢ Used WriteFile (skills/alerts/.gitignore)
â€¢ Used WriteFile (skills/alerts/SKILL.md)
â€¢ Now let me create the main source files. I'll create the index.ts file with th
  e AlertsSkill class and all the necessary types and functionality.
â€¢ Now let me create the main source file with the AlertsSkill class:
â€¢ Used WriteFile (skills/alerts/src/index.ts)
â€¢ Now I need to create the CLI file for the alerts skill.
â€¢ Now let me create the CLI file:
â€¢ Used WriteFile (skills/alerts/src/cli.ts)
â€¢ Now let me install dependencies and run typecheck to ensure the code compiles.
â€¢ Now let me install dependencies and run typecheck:
â€¢ Used Shell (cd skills/alerts && npm install 2>&1)
â€¢ Dependencies installed. Now let me run typecheck to make sure the code compile
  s.
â€¢ Used Shell (cd skills/alerts && npm run typecheck 2>&1)
  Failed with exit code: 2
â€¢ Hmm, the build is failing because alerts uses CommonJS while its dependency, t
  he slack skill, is an ES module. I could try to convert alerts to ESM, but tha
  t might trigger a cascade of changes across the codebase. Actually, the path o
  f least resistance is to treat slack as an optional dependency. If I use dynam
  ic imports, I bypass the static module resolution conflict entirely. This ensu
  res the alerts skill remains stable even if the slack skill's module type diff
  ers. I'll modify index.ts to implement this dynamic loading approach.
â€¢ I need to fix the module import issue. The slack skill is using ES modules. Le
  t me update the alerts skill to handle this:
â€¢ Used StrReplaceFile (skills/alerts/src/index.ts)
â€¢ Now I need to update the AlertsSkill class to use the dynamic import and fix t
  he SlackSkill typing.
â€¢ Used StrReplaceFile (skills/alerts/src/index.ts)
â€¢ Now I need to update the close() method since slack is now a dynamic import:
â€¢ Used StrReplaceFile (skills/alerts/src/index.ts)
â€¢ Now let me run typecheck again:
â€¢ Used Shell (cd skills/alerts && npm run typecheck 2>&1)
â€¢ Typecheck passes. Now let me also run the build to make sure everything compil
  es correctly:
â€¢ Typecheck passes. Let me build and run a quick test:
â€¢ Used Shell (cd skills/alerts && npm run build 2>&1)
â€¢ Build passes. Now let me run the health check to verify the CLI works:
â€¢ Used Shell (cd skills/alerts && node dist/cli.js health 2>&1)
â€¢ The CLI works but binance is not connected. That's expected since there's no b
  inance auth configured in this environment. Let me run the help command to ver
  ify everything is working properly:
â€¢ The skill works. The "unhealthy" status is expected since there's no Binance a
  uth configured. Let me test the help and list commands:
â€¢ Used Shell (cd skills/alerts && node dist/cli.js help 2>&1)
â€¢ All CLI commands work. Now let me commit the changes, update the PRD, and appe
  nd to the progress log. Let me first check git status to see what we need to c
  ommit:
â€¢ All working. Now let me commit the changes:
â€¢ Used Shell (cd /root/code/skills && git add -A && git status)
â€¢ Hmm, I notice there are already staged changes. Let me check if those are from
  a previous operation or if someone else committed them. Actually let me just c
  ommit everything with our new changes included:
â€¢ Used Shell (cd /root/code/skills && g...price notifications" 2>&1)
â€¢ Committed. Now let me update the PRD to mark US-012 as passing, and append to
  the progress log.
â€¢ Now let me update the PRD and progress log:
â€¢ Used StrReplaceFile (prd.json)
â€¢ Now let me append to the progress log:
â€¢ Used WriteFile (progress.txt)
â€¢ Now let me verify that the progress.txt has the right content and the PRD is u
  pdated correctly. Let me also check if there are more stories to work on.
â€¢ Let me verify the changes and check the remaining stories:
â€¢ Used Shell (cd /root/code/skills && g..."passes": false' prd.json)
â€¢ There are still 48 stories with passes: false. US-012 is now complete. Let me
  verify the PRD change was applied correctly:
â€¢ Used Shell (cd /root/code/skills && g...'"id": "US-012"' prd.json)
â€¢ Let me verify the passes status:
â€¢ Used Shell (cd /root/code/skills && g...true' prd.json | head -15)
â€¢ All 12 stories (US-001 to US-012) are now marked as passes: true. Let me confi
  rm by checking the git diff for the PRD:
â€¢ Used Shell (cd /root/code/skills && g... HEAD prd.json | head -30)
â€¢ The PRD has been updated correctly. US-012 now has passes: true.

  Let me now check the progress.txt to ensure the new entry was added:
â€¢ Let me verify the progress.txt update:
â€¢ Used Shell (cd /root/code/skills && head -60 progress.txt)
â€¢ Hmm, I notice my entry wasn't prepended but rather appended at the end. Let me
  check the end of the file:
â€¢ Used Shell (cd /root/code/skills && tail -60 progress.txt)
â€¢ My entry is at the end of the file and the Codebase Patterns section was also
  updated with the new learning about dynamic imports for ES modules.

  Now let me make sure the PRD update was committed:
â€¢ Let me make sure all changes are committed:
â€¢ Used Shell (cd /root/code/skills && git status)
â€¢ The PRD and progress.txt changes are not committed yet. Let me commit them now
  :
